2024-11-28 10:34:01,447 - ===== Athanor started =====
2024-11-28 10:34:01,456 - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:4700
2024-11-28 10:34:01,456 - [33mPress CTRL+C to quit[0m
2024-11-28 10:39:02,333 - ===== Athanor started =====
2024-11-28 10:39:02,343 - [31m[1mWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.[0m
 * Running on http://127.0.0.1:4700
2024-11-28 10:39:02,343 - [33mPress CTRL+C to quit[0m
2024-11-28 10:40:39,813 - Processing new alert: [ cibbbaaaaaaoo ] ============
2024-11-28 10:40:39,814 - Exception on /new-alert [POST]
Traceback (most recent call last):
  File "/home/wazuhserver/.local/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/wazuhserver/.local/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/wazuhserver/.local/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/wazuhserver/.local/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/home/wazuhserver/Desktop/TreeAlchemist/TreeAlchemist/Code/Daemons/./Athanor.py", line 135, in process_new_alert
    alert_infos = athanor_utils.parse_alert_log_line(alert)
  File "/home/wazuhserver/Desktop/TreeAlchemist/TreeAlchemist/Code/Daemons/athanor_utils.py", line 21, in parse_alert_log_line
    rule_index = log_line.index('Rule: ') # Previous information is useless
ValueError: substring not found
2024-11-28 10:40:39,830 - 127.0.0.1 - - [28/Nov/2024 10:40:39] "[35m[1mPOST /new-alert HTTP/1.1[0m" 500 -
2024-11-28 10:40:39,834 - Processing new alert: [ Nov 11 13:27:41 WazuhServer ossec: Alert Level: 15; Rule: 100013 - An attacker has reached "Child3" node.; Location: (Ubuntu-Victim) any->/var/log/absolute_testing.log; classification: Root, TreeAlchemized, ; evil Child3 log ] ============
2024-11-28 10:40:39,834 - A defense has been matched for state [ ('100013',) ] in ADT = [ Root ]. Trying to launch it on agent Ubuntu-Victim.
2024-11-28 10:40:40,176 - Requested a new JWT token to Wazuh API succesfully.
2024-11-28 10:40:40,284 - Defense Launch_TA_Root_Def3.sh0 launched with success on agent 002
2024-11-28 10:40:40,285 - 127.0.0.1 - - [28/Nov/2024 10:40:40] "POST /new-alert HTTP/1.1" 200 -
2024-11-28 10:40:40,288 - Processing new alert: [ Nov 11 13:29:55 WazuhServer ossec: Alert Level: 15; Rule: 100013 - An attacker has reached "Child3" node.; Location: (Ubuntu-Victim) any->/var/log/absolute_testing.log; classification: Root, TreeAlchemized, ; evil Child3 log ] ============
2024-11-28 10:40:40,288 - Alert with rule id 100013 has already been triggered on agent Ubuntu-Victim. Doing nothing.
2024-11-28 10:40:40,288 - 127.0.0.1 - - [28/Nov/2024 10:40:40] "POST /new-alert HTTP/1.1" 200 -
2024-11-28 10:40:40,291 - Processing new alert: [ Nov 11 13:31:37 WazuhServer ossec: Alert Level: 15; Rule: 100013 - An attacker has reached "Child3" node.; Location: (Ubuntu-Victim) any->/var/log/absolute_testing.log; classification: Root, TreeAlchemized, ; evil Child3 log ] ============
2024-11-28 10:40:40,291 - Alert with rule id 100013 has already been triggered on agent Ubuntu-Victim. Doing nothing.
2024-11-28 10:40:40,291 - 127.0.0.1 - - [28/Nov/2024 10:40:40] "POST /new-alert HTTP/1.1" 200 -
2024-11-28 10:40:40,294 - Processing new alert: [ Nov 11 13:44:44 WazuhServer ossec: Alert Level: 15; Rule: 100014 - An attacker has reached "Child4" node.; Location: (Ubuntu-Victim) any->/var/log/absolute_testing.log; classification: Root, TreeAlchemized, ; evil Child4 log ] ============
2024-11-28 10:40:40,294 - No defenses found for state [ ('100013', '100014') ] in ADT = [ Root ]. Doing nothing on agent Ubuntu-Victim.
2024-11-28 10:40:40,294 - 127.0.0.1 - - [28/Nov/2024 10:40:40] "POST /new-alert HTTP/1.1" 200 -
2024-11-28 10:40:40,297 - Processing new alert: [ Nov 11 13:45:34 WazuhServer ossec: Alert Level: 15; Rule: 100013 - An attacker has reached "Child3" node.; Location: (Ubuntu-Victim) any->/var/log/absolute_testing.log; classification: Root, TreeAlchemized, ; evil Child3 log ] ============
2024-11-28 10:40:40,297 - Alert with rule id 100013 has already been triggered on agent Ubuntu-Victim. Doing nothing.
2024-11-28 10:40:40,297 - 127.0.0.1 - - [28/Nov/2024 10:40:40] "POST /new-alert HTTP/1.1" 200 -
2024-11-28 10:40:40,300 - Processing new alert: [ Nov 11 13:46:18 WazuhServer ossec: Alert Level: 14; Rule: 100016 - An attacker has reached "Child1_2" node.; Location: (Ubuntu-Victim) any->/var/log/absolute_testing.log; classification: Root, TreeAlchemized, ; evil Child1_2 log ] ============
2024-11-28 10:40:40,300 - A defense has been matched for state [ ('100016', '100013', '100014') ] in ADT = [ Root ]. Trying to launch it on agent Ubuntu-Victim.
2024-11-28 10:40:40,350 - Defense Launch_TA_Root_Def1_1.sh0 launched with success on agent 002
2024-11-28 10:40:40,414 - Defense Launch_TA_Root_Def3.sh0 launched with success on agent 002
2024-11-28 10:40:40,414 - 127.0.0.1 - - [28/Nov/2024 10:40:40] "POST /new-alert HTTP/1.1" 200 -
2024-11-28 10:40:40,418 - Processing new alert: [ Nov 28 10:40:33 WazuhServer ossec: Alert Level: 15; Rule: 100013 - An attacker has reached "Child3" node.; Location: (Ubuntu-Victim) any->/var/log/absolute_testing.log; classification: Root, TreeAlchemized, ; evil Child3 log ] ============
2024-11-28 10:40:40,418 - Alert with rule id 100013 has already been triggered on agent Ubuntu-Victim. Doing nothing.
2024-11-28 10:40:40,418 - 127.0.0.1 - - [28/Nov/2024 10:40:40] "POST /new-alert HTTP/1.1" 200 -
